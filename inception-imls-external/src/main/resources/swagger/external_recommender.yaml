swagger: "2.0"
info:
  description: >
    This section describes the External Recommender API for INCEpTION. An external recommender is a classifier whose
    functionality is exposed via a HTTP web service. It can predict annotations for given documents and optionally
    be trained on new data. This document describes the endpoints a web service needs to expose so it can be used
    with INCEpTION.

    The documents that are exchanged are in form of a UIMA CAS. For sending, they have to be
    serialized to CAS XMI and then encoded as base64. For receiving, these steps have to be undone. There are two
    main libraries available that manage CAS handling, one is the UIMA Java SDK, the other one dkpro-cassis (Python).
  version: "1.0.0"
  title: "INCEpTION external recommender"
  termsOfService: "https://inception-project.github.io"
  contact:
    email: "inception-users@googlegroups.com"
  license:
    name: "Apache 2.0"
    url: "http://www.apache.org/licenses/LICENSE-2.0.html"
paths:
  /predict:
    post:
      tags:
      - "predict"
      summary: "Predict annotations for a single document"
      description: Sends a CAS together with information about the layer and feature to predict to the external recommender. The external recommender then returns the CAS annotated with predictions.
      operationId: "predictCas"
      consumes:
        - "application/json"
      produces:
        - "application/json"
      parameters:
      - in: "body"
        name: "body"
        description: "Document CAS for which annotations will be predicted"
        required: true
        schema:
          $ref: "#/definitions/PredictRequest"
      responses:
        200:
          description: "Successful prediction"
          schema:
            $ref: "#/definitions/PredictResponse"
  /train:
    post:
      tags:
      - "train"
      summary: "Train recommender on a set of documents"
      description: Sends a list of CASses to the external recommender for training. No response body is expected.
      operationId: "trainRecommender"
      consumes:
        - "application/json"
      parameters:
      - in: "body"
        name: "body"
        description: "List of documents CAS whose annotations will be used for training"
        required: true
        schema:
          $ref: "#/definitions/Train"
      responses:
        204:
          description: "Successful training"
        429:
          description: "Too many training requests have been sent, the sender should wait a while until the next request"
definitions:
  PredictRequest:
    type: object
    properties:
      layer:
        type: "string"
        description: "Layer which should be predicted"
        example: "de.tudarmstadt.ukp.dkpro.core.api.ner.type.NamedEntity"
      feature:
        type: "string"
        description: "Feature of the layer which should be predicted"
        example: "value"
      document:
        type: "string"
        example: "Cjw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+Cjx4bWk6WE1JIHhtbG5zOnRjYXM9Imh0dHA6Ly8vdWltYS90Y2FzLmVjb3JlIiB4bWxuczp4bWk9Imh0dHA6Ly93d3cub21nLm9yZy9YTUkiIHhtbG5zOmNhcz0iaHR0cDovLy91aW1hL2Nhcy5lY29yZSIKICAgICAgICAgeG1sbnM6Y2Fzc2lzPSJodHRwOi8vL2Nhc3Npcy5lY29yZSIgeG1pOnZlcnNpb249IjIuMCI+CiAgICA8Y2FzOk5VTEwgeG1pOmlkPSIwIi8+CiAgICA8dGNhczpEb2N1bWVudEFubm90YXRpb24geG1pOmlkPSI4IiBzb2ZhPSIxIiBiZWdpbj0iMCIgZW5kPSI0NyIgbGFuZ3VhZ2U9IngtdW5zcGVjaWZpZWQiLz4KICAgIDxjYXM6U29mYSB4bWk6aWQ9IjEiIHNvZmFOdW09IjEiIHNvZmFJRD0ibXlTb2ZhIiBtaW1lVHlwZT0idGV4dC9wbGFpbiIKICAgICAgICAgICAgICBzb2ZhU3RyaW5nPSJKb2Ugd2FpdGVkIGZvciB0aGUgdHJhaW4gLiBUaGUgdHJhaW4gd2FzIGxhdGUgLiIvPgogICAgPGNhczpWaWV3IHNvZmE9IjEiIG1lbWJlcnM9IjgiLz4KPC94bWk6WE1JPg=="
        description: "CAS as XMI which has been base64 encoded"
      typeSystem:
        type: "string"
        example: "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHR5cGVTeXN0ZW1EZXNjcmlwdGlvbiB4bWxucz0iaHR0cDovL3VpbWEuYXBhY2hlLm9yZy9yZXNvdXJjZVNwZWNpZmllciI+CiAgICA8dHlwZXM+CiAgICAgICAgPHR5cGVEZXNjcmlwdGlvbj4KICAgICAgICAgICAgPG5hbWU+dWltYS50Y2FzLkRvY3VtZW50QW5ub3RhdGlvbjwvbmFtZT4KICAgICAgICAgICAgPGRlc2NyaXB0aW9uLz4KICAgICAgICAgICAgPHN1cGVydHlwZU5hbWU+dWltYS50Y2FzLkFubm90YXRpb248L3N1cGVydHlwZU5hbWU+CiAgICAgICAgICAgIDxmZWF0dXJlcz4KICAgICAgICAgICAgICAgIDxmZWF0dXJlRGVzY3JpcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPG5hbWU+bGFuZ3VhZ2U8L25hbWU+CiAgICAgICAgICAgICAgICAgICAgPGRlc2NyaXB0aW9uLz4KICAgICAgICAgICAgICAgICAgICA8cmFuZ2VUeXBlTmFtZT51aW1hLmNhcy5TdHJpbmc8L3JhbmdlVHlwZU5hbWU+CiAgICAgICAgICAgICAgICA8L2ZlYXR1cmVEZXNjcmlwdGlvbj4KICAgICAgICAgICAgPC9mZWF0dXJlcz4KICAgICAgICA8L3R5cGVEZXNjcmlwdGlvbj4KICAgIDwvdHlwZXM+CjwvdHlwZVN5c3RlbURlc2NyaXB0aW9uPg=="
        description: "Type system XML of the CAS which has been base64 encoded"
    required:
      - layer
      - feature
      - document
      - typeSystem
  PredictResponse:
    type: object
    properties:
      document:
        type: "string"
        example: "Cjw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+Cjx4bWk6WE1JIHhtbG5zOnRjYXM9Imh0dHA6Ly8vdWltYS90Y2FzLmVjb3JlIiB4bWxuczp4bWk9Imh0dHA6Ly93d3cub21nLm9yZy9YTUkiIHhtbG5zOmNhcz0iaHR0cDovLy91aW1hL2Nhcy5lY29yZSIKICAgICAgICAgeG1sbnM6Y2Fzc2lzPSJodHRwOi8vL2Nhc3Npcy5lY29yZSIgeG1pOnZlcnNpb249IjIuMCI+CiAgICA8Y2FzOk5VTEwgeG1pOmlkPSIwIi8+CiAgICA8dGNhczpEb2N1bWVudEFubm90YXRpb24geG1pOmlkPSI4IiBzb2ZhPSIxIiBiZWdpbj0iMCIgZW5kPSI0NyIgbGFuZ3VhZ2U9IngtdW5zcGVjaWZpZWQiLz4KICAgIDxjYXM6U29mYSB4bWk6aWQ9IjEiIHNvZmFOdW09IjEiIHNvZmFJRD0ibXlTb2ZhIiBtaW1lVHlwZT0idGV4dC9wbGFpbiIKICAgICAgICAgICAgICBzb2ZhU3RyaW5nPSJKb2Ugd2FpdGVkIGZvciB0aGUgdHJhaW4gLiBUaGUgdHJhaW4gd2FzIGxhdGUgLiIvPgogICAgPGNhczpWaWV3IHNvZmE9IjEiIG1lbWJlcnM9IjgiLz4KPC94bWk6WE1JPg=="
        description: "CAS with annotations from the external recommender as XMI which has been base64 encoded"
    required:
      - document
  Train:
    type: object
    properties:
      layer:
        type: "string"
        description: "Layer which should be predicted"
        example: "de.tudarmstadt.ukp.dkpro.core.api.ner.type.NamedEntity"
      feature:
        type: "string"
        description: "Feature of the layer which should be predicted"
        example: "value"
      documents:
        type: "array"
        items:
          type: "string"
        example:
          - "Cjw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+Cjx4bWk6WE1JIHhtbG5zOnRjYXM9Imh0dHA6Ly8vdWltYS90Y2FzLmVjb3JlIiB4bWxuczp4bWk9Imh0dHA6Ly93d3cub21nLm9yZy9YTUkiIHhtbG5zOmNhcz0iaHR0cDovLy91aW1hL2Nhcy5lY29yZSIKICAgICAgICAgeG1sbnM6Y2Fzc2lzPSJodHRwOi8vL2Nhc3Npcy5lY29yZSIgeG1pOnZlcnNpb249IjIuMCI+CiAgICA8Y2FzOk5VTEwgeG1pOmlkPSIwIi8+CiAgICA8dGNhczpEb2N1bWVudEFubm90YXRpb24geG1pOmlkPSI4IiBzb2ZhPSIxIiBiZWdpbj0iMCIgZW5kPSI0NyIgbGFuZ3VhZ2U9IngtdW5zcGVjaWZpZWQiLz4KICAgIDxjYXM6U29mYSB4bWk6aWQ9IjEiIHNvZmFOdW09IjEiIHNvZmFJRD0ibXlTb2ZhIiBtaW1lVHlwZT0idGV4dC9wbGFpbiIKICAgICAgICAgICAgICBzb2ZhU3RyaW5nPSJKb2Ugd2FpdGVkIGZvciB0aGUgdHJhaW4gLiBUaGUgdHJhaW4gd2FzIGxhdGUgLiIvPgogICAgPGNhczpWaWV3IHNvZmE9IjEiIG1lbWJlcnM9IjgiLz4KPC94bWk6WE1JPg=="
        description: "CAS as XMI which has been base64 encoded"
      typeSystem:
        type: "string"
        example: "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHR5cGVTeXN0ZW1EZXNjcmlwdGlvbiB4bWxucz0iaHR0cDovL3VpbWEuYXBhY2hlLm9yZy9yZXNvdXJjZVNwZWNpZmllciI+CiAgICA8dHlwZXM+CiAgICAgICAgPHR5cGVEZXNjcmlwdGlvbj4KICAgICAgICAgICAgPG5hbWU+dWltYS50Y2FzLkRvY3VtZW50QW5ub3RhdGlvbjwvbmFtZT4KICAgICAgICAgICAgPGRlc2NyaXB0aW9uLz4KICAgICAgICAgICAgPHN1cGVydHlwZU5hbWU+dWltYS50Y2FzLkFubm90YXRpb248L3N1cGVydHlwZU5hbWU+CiAgICAgICAgICAgIDxmZWF0dXJlcz4KICAgICAgICAgICAgICAgIDxmZWF0dXJlRGVzY3JpcHRpb24+CiAgICAgICAgICAgICAgICAgICAgPG5hbWU+bGFuZ3VhZ2U8L25hbWU+CiAgICAgICAgICAgICAgICAgICAgPGRlc2NyaXB0aW9uLz4KICAgICAgICAgICAgICAgICAgICA8cmFuZ2VUeXBlTmFtZT51aW1hLmNhcy5TdHJpbmc8L3JhbmdlVHlwZU5hbWU+CiAgICAgICAgICAgICAgICA8L2ZlYXR1cmVEZXNjcmlwdGlvbj4KICAgICAgICAgICAgPC9mZWF0dXJlcz4KICAgICAgICA8L3R5cGVEZXNjcmlwdGlvbj4KICAgIDwvdHlwZXM+CjwvdHlwZVN5c3RlbURlc2NyaXB0aW9uPg=="
        description: "Type system XML of the CAS which has been base64 encoded"
    required:
      - layer
      - feature
      - documents
      - typeSystem